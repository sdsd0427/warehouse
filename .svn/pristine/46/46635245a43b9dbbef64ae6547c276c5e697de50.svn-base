<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<head>
	<link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/board.css">
	<link rel="stylesheet" href="<%=request.getContextPath() %>/resources/bootstrap/plugins/summernote/summernote-bs4.min.css">
</head>

<body>

<div class="wrapper">
	<section class="content-header">
		<div class="container-fluid">
			<div class="row md-2">
				<div>
					<h3>공지사항</h3>
				</div>
				<div style="display: inline; margin-left: 10px; margin-top: 10px;">
					<span  class="text-muted"  style="padding-right: 620px;">게시판 > 공지사항</span>
				</div>
			</div>
		</div>
	</section>

	<section class="content container-fluid">
		<div class="card card-navy card-outline">
			<div class="card-header">
				<h3 class="card-title" style="padding-top: 8px;">공지사항 수정</h3>
				<div class="col-lg-12">
					<button class="btn btn-outline-dark float-right" style="margin-left:20px;" type="button" onclick="javascript:history.back();">취소</button>
					<button class="btn btn-outline-primary float-right"  type="button" onclick="modify_go()">수정</button>
				</div>
			</div>

			<div class="card-body">
			<form enctype="multipart/form-data" role="form" method="post" action="noticeModify.do" name="modifyForm">
			<input type="hidden" name="boardNo" value="${board.boardNo }" />
			<div class="form-group row">
			<label class="col-2 mt-3">상단 고정</label>
					<div class="row">
						<div class="custom-control col-12 mt-3" style="padding-left:30px;">
							<div class="custom-checkbox">
								<input class="form-check-input" type="checkbox" id="fix" name="fix" value="" ${board.fix eq '1'? 'checked':'' }>
								<label>고정</label>
							</div>
						</div>
					</div>
					</div>
					<div class="form-group row">
						<label class="col-2">제목</label>
						<input class="form-control col-10" type="text" class="form-control" id="boardTitle" name="boardTitle" value="${board.boardTitle }">
					</div>
					<div class="form-group row">
						<label class="col-2">작성자</label>
						<input class="form-control col-10" type="text" class="form-control" id="name" name="name" value="${board.name }" readonly>
					</div>
					<div class="form-group row">
						<label class="col-2" for="content">내용</label>
						   <textarea class="form-control" name="boardContent" id="boardContent" rows="5" cols=""
							placeholder="" >${board.boardContent }</textarea>
					</div>
					<div class="card card-light card-outline">
						<div class="card-header" style="font-size: medium;">
						<h5 class="card-title"><i class="fas fa-paperclip"></i>&nbsp;&nbsp;첨부파일</h5>
						&nbsp;&nbsp;&nbsp;<button class="btn btn-xs btn-info"
										onclick="addFile_go();"	type="button" id="addFileBtn">Add File</button>
						</div>
						<div class="card-footer fileInput">
						<div class="form-group">
							<ul class="mailbox-attachments d-flex align-items-stretch clearfix">

								<c:forEach items="${board.attachList }" var="attach" >
									<li class="attach-item thumb${attach.attachNo }" file-name="${attach.fileName }" target-ano="${attach.attachNo }">
										<div class="mailbox-attachment-info ">
											<a class="mailbox-attachment-name" name="attachedFile" attach-fileName="${attach.fileName }" attach-no="${attach.attachNo }" href="<%=request.getContextPath()%>/free/getFile.do?attachNo=${attach.attachNo }"  >
												<i class="fas fa-paperclip"></i>
												${attach.fileName }&nbsp;&nbsp;
												<button type="button" onclick="removeFile_go('thumb${attach.attachNo}');return false;" style="border:0;outline:0;"
														class="badge bg-red">X</button>
											</a>
										</div>
									</li>
								</c:forEach>
							</ul>
							<br/>
						</div>
					</div>
					</div>
				</form>
			</div>

		</div>
	</section>

</div>

<script>
console.log("size",${fixBoardListSize});
$(function(){
   summernote_go($('#boardContent'),'<%=request.getContextPath()%>');
})

function removeFile_go(className){
	var li = $('li.'+className);
	if(!confirm(li.attr("file-name")+"을 정말 삭제하시겠습니까?")){
		return;
	}
	li.remove();

	var input=$('<input>').attr({"type":"hidden",
		"name":"deleteFile",
		"value":li.attr("target-ano")
		})
	$('form[role="form"]').prepend(input);
}

var dataNum=0;
function addFile_go(){
	var attachedFile=$('a[name="attachedFile"]').length;
	var inputFile=$('input[name="uploadFile"]').length;
	var attachCount=attachedFile+inputFile;

	if(attachCount>=5){
		alert("파일추가는 5개까지만 가능합니다.");
		return;
	}

	var div=$('<div>').addClass("inputRow").attr("data-no",dataNum);
	var input=$('<input>').attr({"type":"file","name":"uploadFile"}).css("display","inline");
	div.append(input).append("<button onclick='remove_go("+dataNum+");' style='border:0;outline:0;' class='badge bg-red' type='button'>X</button>");

	$('.fileInput').append(div);
	dataNum++;
}

function modify_go(){
	var files = $('input[name="uploadFile"]');
	for(var file of files){
		console.log(file.name+" : "+file.value);
		if(file.value==""){
			alert("파일을 선택하세요.");
			file.focus();
			return false;
		}
	}

	var form = $('form[name="modifyForm"]');

	if($("#fix").is(":checked")){
		if(parseInt('${fixBoardListSize}') > 6){
			alert("상단 고정은 5개까지 가능합니다.");
			return;
		}
		$("#fix").attr("value","1");
		alert("상단 고정 공지로 등록합니다.");
	}else{
		alert("상단 고정 공지를 해제합니다.");
	}

	if($("input[name='boardTitle']").val()==""){
		alert("제목은 필수입니다.");
		$("input[name='boardTitle']").focus();
		return;
	}
	$("form[role='form']").submit()
}
</script>

</body>
